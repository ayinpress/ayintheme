function CFGText(t,e){function i(t,e,s,o,a){if(s[t]&&s[t].length>0){let n=Cool.choice(s[t]);if(Array.isArray(n))for(let a=0;a<n.length;a++)i(n[a],e,s,o,t);else e.push({word:n,pos:t}),s[t].splice(s[t].indexOf(n),1);return e}if(n[t]){let a,h=o[t]?n[t].filter((e=>e.includes(o[t]))):n[t];0===h.length?(console.log("no filter",t,o),a=Cool.choice(n[t])):a=Cool.choice(h);for(let n=0;n<a.length;n++)i(a[n],e,s,o,t)}else e.push({word:t,pos:a});return e}function s(t){let e=t.map((t=>t.word)).join(" ");e=e.replace(/\s+(?=[.?!,])/g,""),e=e.replace(/^\s+/,""),e=e.replace(/\ba (?=[aeiou])/gi,"an "),e=e.replace(/\ban (?![aeiou])/gi,"a "),e=e.replace(/ \' /g,"'"),e=e.replace(/\bi\b/g,"I"),e=e[0].toUpperCase()+e.substring(1,e.length);let i=e.match(/[\.\?\!]\s[a-z]/g);return i&&i.forEach((t=>{let i=t.substring(0,t.length-1)+t[t.length-1].toUpperCase();e=e.replace(t,i)})),e}let n={};this.isReady=!1,this.load=function(t,e){fetch(t).then((t=>t.json())).then((t=>{this.feed(t),this.isReady=!0,e&&e()})).catch((t=>{console.log(t)}))},this.feed=function(t){for(const e in t)n[e]=t[e];!this.isReady&&Object.keys(n).length>0&&(this.isReady=!0)},this.getGrammar=function(t){return t?n[t]:n},this.getText=function(t,e,o){let a=t||"S";for("string"==typeof e&&(e=JSON.parse(e));!n[a]>0&&!e[a];)a="S";let h=i(a,[],e||{},o||{});return{text:s(h),tags:h}},t&&this.load(t,e)}"undefined"!=typeof module&&(module.exports=CFGText);class HolyFool extends UI{constructor(t){super(t),this.center=!0,this.actionInterval=Cool.randomInt(100,200),this.actionCount=0,this.isActive=!1,this.label=t.label,t.hasDialog&&(this.dialog=new Dialog(this.xy)),t.actionCallback&&(this.actionCallback=t.actionCallback),this.actionQueue=[]}setActionCount(t){this.actionInterval=t||Cool.randomInt(100,200),this.actionCount=0}isActionDone(){return this.actionCount>=this.actionInterval}actionUpdate(){this.actionCount++}callActionCallback(){this.actionCallback&&this.actionCallback(this.label,"action")}addAction(t){this.actionQueue.push(t)}startDialog(t){if(!this.dialogEnabled)return!1;let e=this.xy[0]<512?"right":"left";this.dialog.start(t,this.xy,this.size,e,"speech")}display(){if(super.display(),this.dialog&&this.dialog.isActive){this.dialog.display()&&(this.onDialogEnd&&(this.onDialogEnd(),this.dialog.state="finished"),this.actionCallback&&this.actionCallback(this.label,"dialog"))}}update(){if((!this.dialog||!this.dialog.isActive)&&this.actionQueue.length>0){const t=this.actionQueue[0];t.update&&t.update(),t.target()&&(this.actionQueue.shift(),t.end(),this.actionQueue[0]&&this.actionQueue[0].start&&this.actionQueue[0].start())}}}class Dialog{constructor(t){this.text=new Text(t[0],t[1],"test",18,GAME.anims.sprites.letters),this.text.countCount=.5,this.text.endCount=1,this.text.endDelay=60,this.text.isActive=!1,this.state="ready",this.bubble={right:{speech:new Sprite(0,0,GAME.anims.sprites.speech_right),thought:new Sprite(0,0,GAME.anims.sprites.thought_right)},left:{speech:new Sprite(0,0,GAME.anims.sprites.speech_left),thought:new Sprite(0,0,GAME.anims.sprites.thought_left)},dir:"left",state:"speech"}}get isActive(){return this.text.isActive}display(){let t=this.text.display(!0,!0,!0);return t||this.bubble[this.bubble.dir][this.bubble.state].display(),!(!t||"started"!==this.state)&&(this.end(),this.state="finished",!0)}start(t,e,i,s,n){this.state="started",this.text.setMsg(t),this.text.isActive=!0,e[0]<GAME.halfWidth&&"left"===s&&(s="right"),e[0]>GAME.halfWidth&&"right"===s&&(s="left"),this.text.x=e[0]+("right"===s?i[0]/2:-this.text.width-i[0]/2),this.text.y=e[1]+i[1]/4,this.text.x<256&&(this.text.x=256),this.text.x+this.text.width>GAME.width-256&&(this.text.x=GAME.width-this.text.width-256),this.text.y>e[1]-i[1]/2&&(this.text.y=e[1]-i[1]/2),this.text.y-this.text.height<0&&(this.text.y=this.text.height),this.text.y>GAME.halfHeight&&(this.text.y=GAME.halfHeight),this.bubble.state=n,this.bubble.dir=s,this.bubble[this.bubble.dir][this.bubble.state].animation.loop=!1,this.bubble[this.bubble.dir][this.bubble.state].animation.frame=0,this.bubble[this.bubble.dir][this.bubble.state].animation.play(),this.bubble[this.bubble.dir][this.bubble.state].position=[this.text.x+this.text.width/2,this.text.y+24]}end(){this.text.isActive=!1}}class Dog extends HolyFool{constructor(t){super(t),this.label="dog",this.speed=[0,0],this.animationStates=Object.keys(this.animation.states),this.offScreen=!0,this.startPosition=[GAME.width+this.width,GAME.height-this.height],this.startSpeed=[-2,0]}firstTarget(){return this.position[0]<.75*GAME.width}endTarget(){return this.position[0]<-this.width}checkSides(){this.speed[0]>0&&this.position[0]>GAME.width-this.halfWidth&&(this.speed[0]*=-1)}setAction(){this.isActive=!0,this.actionQueue=[],this.speed=[...this.startSpeed],this.offScreen?(this.position=[...this.startPosition],this.offScreen=!1,this.addAction({target:this.firstTarget.bind(this),update:this.walk.bind(this),end:()=>{this.chill(),this.setActionCount()}})):(this.setActionCount(),this.actionQueue.push({target:this.isActionDone.bind(this),update:()=>{this.walk(),this.actionUpdate()},end:()=>{this.chill(),this.setActionCount()}}));for(let t=0,e=Cool.randomInt(1,3);t<e;t++)this.addAction({target:this.isActionDone.bind(this),update:this.actionUpdate.bind(this),end:()=>{this.move(),this.setActionCount()}}),this.actionQueue.push({target:this.isActionDone.bind(this),update:()=>{this.walk(),this.actionUpdate()},end:()=>{this.chill(),this.setActionCount()}});this.addAction({target:this.isActionDone.bind(this),update:this.actionUpdate.bind(this),end:()=>{this.speed=[...this.startSpeed]}}),this.addAction({target:this.endTarget.bind(this),update:this.walk.bind(this),end:()=>{this.isActive=!1,this.offScreen=!0,this.actionCallback&&this.actionCallback(this.label,"action")}})}walk(){Math.abs(this.speed[0])+Math.abs(this.speed[1])>0&&(this.position[0]+=this.speed[0],this.position[1]+=this.speed[1],this.speed[0]>0?this.animation.state="walk_right":this.speed[0]<0?this.animation.state="walk_left":this.speed[1]>0?this.animation.state="walk_right":this.speed[1]<0&&(this.animation.state="walk_left")),(this.position[1]>GAME.height-this.height||this.position[1]<GAME.halfHeight)&&(this.speed[1]*=-1),this.checkSides()}move(){this.speed=[Cool.choice(-1,0,1),Cool.choice(-1,0,1)],this.speed[0]+this.speed[1]===0&&(this.speed[Cool.choice(0,1)]=Cool.choice(-1,1)),Math.abs(this.speed[0])>0&&Math.abs(this.speed[1])>0&&(this.speed[0]*=.71,this.speed[1]*=.71)}chill(){let t=this.speed[0]>0?"right":"left",e=Cool.choice("sit","idle"),i=this.animationStates.filter((i=>i.includes(e)&&i.includes(t)));this.animation.state=Cool.choice(i),this.speed=[0,0]}startDialog(t){let e=this.position[0]<GAME.halfWidth?"right":"left";this.animation.state=`talk_${e}`,this.dialog.start(t,this.xy,this.size,e,"speech"),this.speed=[0,0]}onDialogEnd(){this.speed=[...this.startSpeed],this.actionQueue=[],this.addAction({target:this.endTarget.bind(this),update:this.walk.bind(this),end:()=>{this.isActive=!1,this.offScreen=!0,this.actionCallback&&this.actionCallback(this.label,"action")}})}}function FoolTOC(){Cool.mobilecheck()&&document.body.classList.add("mobile");let t="./data/card_names.txt",e="./drawings/";"undefined"!=typeof fool_dir&&(t=fool_dir.foolURL+"/assets/holy_fool/data/card_names.txt",e=fool_dir.foolURL+"/assets/holy_fool/drawings/");const i=new Markov(t,1,24,!1,(()=>{const t=i.getText();n.textContent=t})),s=document.createElement("li");s.classList.add("journal-artist-preview");const n=document.createElement("a");n.href="undefined"!=typeof fool_dir?"https://staging4.ayinpress.org/the-moon/":"fool.html",s.appendChild(n),document.getElementsByClassName("journal-toc-list")[0].appendChild(s);const o=document.getElementById("ayin-two-journal-preview");s.addEventListener("mouseover",(()=>{if("idle"===d.scenes.currentName){const t=Cool.choice(["lobster","moon","dog"]);d.scenes.current=t,a.style.display="block",o.style.opacity=0}})),s.addEventListener("mouseout",(()=>{d.scenes.current="idle",o.style.opacity=1}));const a=document.getElementById("lines"),h=a.parentElement;a.style.zIndex=-1,a.style.position="absolute",a.style.left="50%",a.style.transform="translate(-50%, 0)",h.style.position="relative";let l=window.innerWidth,r=Math.round(l/2),c=Math.round(384);const d=new Game({dps:24,lineWidth:2,width:l,height:768,multiColor:!1,checkRetina:!0,suspend:!0,scenes:["dog","lobster","moon","idle"]});let u,p,g,m;d.loadAssets("sprites",{fool:e+"fool.json",moon:e+"moon_2.json",lobster:e+"lobster.json",letters:e+"letters.json"}),d.start=function(){u=new Dog({x:r+d.anims.sprites.fool.width,y:768-d.anims.sprites.fool.height,animation:d.anims.sprites.fool,actionCallback:()=>{console.log("action",u),u.setAction()}}),d.scenes.dog.addSprite(u),u.setAction(),p=new Moon({x:l+128,y:256,animation:d.anims.sprites.moon,actionCallback:()=>{console.log("action",p),p.setAction()}}),d.scenes.moon.addSprite(p),p.setAction(),g=new Lobster({x:l-128,y:c+128,animation:d.anims.sprites.lobster,actionCallback:()=>{console.log("action",g),g.setAction()}}),d.scenes.lobster.addSprite(g),g.setAction();m=new Text(d.halfWidth,d.halfHeight,"The fool always carries them, although he has long since forgotten what they mean.",13,d.anims.sprites.letters),m.x-=m.width/2,m.countForward=!0,d.scenes.add(m,["dog","moon","lobster"],"display"),d.scenes.current="moon"},d.update=function(t){d.scenes.current.update()},d.draw=function(){d.scenes.current.display()}}class Lobster extends HolyFool{constructor(t){super(t),this.animation.state="emerge",this.speed=[0,0],this.animation.onPlayedOnce=()=>{this.start()},this.label="lobster"}start(){this.animation.loop=!0,this.animation.state="walk_left",this.speed=[-4,Cool.random(-1,1)]}firstTarget(){return this.position[0]<128}endTarget(){return this.position[0]>GAME.width-128}return(){this.animation.state="walk_right",this.animation.loop=!0,this.speed=[4,Cool.random(-1,1)]}onDialogEnd(){this.actionCount=this.actionInterval,this.start()}emerge(){this.animation.state="emerge",this.animation.loop=!1,this.animation.play(),this.animation.onPlayedOnce=()=>{this.start()}}submerge(){this.animation.state="submerge",this.animation.loop=!1,this.animation.onPlayedOnce=()=>{this.isActive=!1}}setAction(t){this.isActive=!0,this.emerge(),t&&(this.actionCount=0,this.actionInterval=120,this.actionQueue.push({target:()=>this.actionCount>this.actionInterval,update:()=>{this.walk(),this.actionCount++},end:()=>{this.startDialog(this.dialogMessage,!0)}})),this.actionQueue.push({target:this.firstTarget.bind(this),update:this.walk.bind(this),end:()=>{this.return(),this.setActionCount(Cool.randomInt(30,180))}}),this.actionQueue.push({target:this.isActionDone.bind(this),update:()=>{this.walk(),this.actionCount++},end:()=>{const t=this.position[0]<GAME.halfWidth?"right":"left";this.animation.state=`talk_${t}`,this.speed=[0,0],this.setActionCount(240)}}),this.actionQueue.push({target:this.isActionDone.bind(this),update:this.actionUpdate.bind(this),end:this.return.bind(this)}),this.actionQueue.push({target:this.endTarget.bind(this),update:this.walk.bind(this),end:()=>{this.submerge(),this.speed=[0,0],this.setActionCount(120)}}),this.actionQueue.push({target:this.isActionDone.bind(this),update:this.actionUpdate.bind(this),end:this.callActionCallback.bind(this)})}walk(){Math.abs(this.speed[0])+Math.abs(this.speed[1])>0&&(this.position[0]+=this.speed[0],this.position[1]+=this.speed[1]),(this.position[1]>GAME.height-this.height||this.position[1]<GAME.halfHeight)&&(this.speed[1]*=-1)}startDialog(t,e){if(this.dialogMessage=t,!e)return void this.setAction(!0);const i=this.position[0]<GAME.halfWidth?"right":"left";this.animation.state=Cool.choice(`talk_${i}`,`talk_${i}`),this.dialog.start(t,this.xy,this.size,i,"thought"),this.speed=[0,0]}}function Markov(t,e,i,s,n){e=Number(e),i=Number(i);let o={},a=[],h=s;function l(t){return t.split(/\s+/)}function r(t){let i=t;if(h&&(i=l(t)),i.length<e)return!1;let s=h?i.slice(0,e).join(" "):i.substring(0,e);a.push(s);for(let t=0;t<i.length-e;t++){let s,n;h?(s=i.slice(t,t+e).join(" "),n=i[t+e]):(s=i.substring(t,t+e),n=i.charAt(t+e)),o.hasOwnProperty(s)||(o[s]=[]),o[s].push(n)}}function c(t){return Array.isArray(t)||(t=[...arguments]),t[Math.floor(Math.random()*t.length)]}t&&fetch(t).then((t=>t.text())).then((t=>{t.split("\n").forEach((t=>r(t))),this.isReady=!0,n&&n()})).catch((t=>{console.log(t)})),this.isReady=!1,this.getText=function(){return!!this.isReady&&function(){current=c(a);let t=h?l(current):current;for(let s=0;s<i&&o.hasOwnProperty(current);s++){let i=c(o[current]);h?(t.push(i),current=t.slice(t.length-e,t.length).join(" ")):(t+=i,current=t.substring(t.length-e,t.length))}return h&&(t=t.join(" ")),t}()},this.feed=function(t){r(t),a.length>0&&(this.isReady=!0)}}"undefined"!=typeof module&&(module.exports={Markov:Markov});class Moon extends HolyFool{constructor(t){super(t),this.center=!0,this.faces=[];for(let t=0;t<=this.animation.endFrame;t++)this.animation.createNewState(`face-${t}`,t,t),this.faces.push(`face-${t}`);this.animation.state="face-0",this.angle=Math.PI/2,this.label="moon",this.dialogMessage="",this.moonNeedsToLeave=!0}setDialogMessage(t){this.dialogMessage=t}startDialog(t,e){this.dialogMessage=t,e?this.dialog.start(this.dialogMessage,this.xy,this.size,"left","speech"):this.setAction(!0)}onDialogEnd(){this.actionCount=this.actionInterval}leave(){this.moonNeedsToLeave=!1,this.actionQueue.push({target:()=>this.angle>1.5*Math.PI,update:()=>{this.orbit()},end:()=>{this.animation.state=`face-${Cool.randomInt(this.animation.endFrame)}`,this.angle=Math.PI/2,this.isActive=!1,this.actionCallback&&this.actionCallback(this.label,"action")}})}setAction(t){this.isActive=!0,t?this.actionQueue.push({target:()=>this.position[0]<.75*GAME.width,update:()=>{this.orbit()},end:()=>{this.actionCallback&&this.actionCallback(this.label,"action")}}):(this.actionQueue.push({target:()=>this.position[0]<.75*GAME.width,update:()=>{this.orbit()},end:()=>{this.setActionCount(240)}}),this.actionQueue.push({target:()=>this.actionCount>=this.actionInterval,update:()=>{this.actionCount++},end:()=>{this.orbit()}}),this.actionQueue.push({target:()=>this.angle>1.5*Math.PI,update:()=>{this.orbit()},end:()=>{this.animation.state=`face-${Cool.randomInt(this.animation.endFrame)}`,this.angle=Math.PI/2,this.isActive=!1,this.actionCallback&&this.actionCallback(this.label,"action")}}))}orbit(){this.position[0]=Math.round(GAME.halfWidth+Math.sin(this.angle)*(GAME.halfWidth+this.halfWidth)),this.position[1]=Math.round(384+256*Math.abs(Math.cos(this.angle))*-1),this.angle+=Math.PI/512}}class Scenery extends UI{constructor(t,e,i,s){if(super({x:t,y:e,animation:i}),this.center=!0,s=s||16,i.states.in){const t=GAME.data.jsons[i.src];this.animation=new GameAnim,this.animation.loadData(t)}this.animation.state.end=2*s+1,this.animation.layers.forEach((t=>{t.endFrame=2*s+1,t.tweens.push({prop:"endIndex",startFrame:0,endFrame:s,startValue:0,endValue:this.animation.drawings[t.drawingIndex].length}),t.tweens.push({prop:"startIndex",startFrame:s+2,endFrame:2*s+1,startValue:0,endValue:this.animation.drawings[t.drawingIndex].length})})),this.animation.setFrames(),this.animation.createNewState("in",0,s),this.animation.createNewState("idle",s+1,s+1),this.animation.createNewState("out",s+2,2*s+1),this.animation.state="in",this.animation.play(),this.animation.onPlayedState=function(){this.state="idle"}}}function SceneryManager(t,e){const i=this;Object.assign(Scenery.prototype,{onOver(){e.animation.state="hover"},onOut(){e.animation.state="idle"},onClick(){i.newSprite(this)}});let s={};for(const e in t)s[e]=new SpriteCollection,GAME.scenes.main.addUI(s[e]);let n,o,a,h=128,l=GAME.width-128,r=64,c=GAME.width,d=(GAME.height,GAME.halfWidth),u=GAME.halfHeight;function p(t){switch(t){case"towers":return[[h,u],[l,u]];case"landscapes":return[[Cool.randomInt(h,d-r),o],[Cool.randomInt(d+r,l),o]];case"stuff":return[[Cool.randomInt(256,d-r),Cool.randomInt(u+r,u+192)],[Cool.randomInt(d+r,c-256),Cool.randomInt(u+r,u+192)]];case"waves":case"waves_2":return[[Cool.randomInt(h,d-r),n],[Cool.randomInt(d-r,d+r),n],[Cool.randomInt(d+r,l),n]]}}this.setup=function(){[n,o]=Cool.shuffle([GAME.height-96,GAME.height-192]),a=Cool.choice(["waves","waves_2"]);let e=0;["towers","landscapes","stuff",a].forEach((i=>{p(i).forEach((n=>{if(Cool.chance(.666)&&e<4){let o=`${i}_${Cool.randomInt(t[i])}`,a=new Scenery(n[0],n[1],GAME.anims.sprites[o]);a.type=i,s[i].add(a),e++}}))}))},this.update=function(){let e,i=Object.keys(s),n=Cool.choice(i),o=s[n];if(i.filter((t=>s[t].length>0)).includes(n)&&Cool.chance(.666))e=Cool.choice(o.sprites),this.newSprite(e,n);else{let e=Cool.choice(p(n)),i=`${n}_${Cool.randomInt(t[n])}`,o=new Scenery(e[0],e[1],GAME.anims.sprites[i]);s[n].add(o)}},this.newScene=function(){for(const t in s)s[t].all((e=>{this.newSprite(e,t)}))},this.newSprite=function(e,i){i=i||Cool.choice(Object.keys(s)),e.animation.state="out",e.animation.onPlayedState=function(){e.isActive=!1,s[i].remove(e);let n=Cool.choice(p(i)),o=`${i}_${Cool.randomInt(t[i])}`,a=new Scenery(n[0],n[1],GAME.anims.sprites[o]);s[i].add(a)}}}function Sequencer(t,e,i){const s=this;this.moonIntroDone=!1,this.actors=new SpriteCollection;let n,o=0,a=!1,h=0,l=4;this.setCurrentActor=function(t){n=t},this.onActionEnd=function(r,c){s.moonIntroDone?("action"===c&&("moon"===n.label||o<4?(n=Cool.choice(s.actors.sprites.filter((t=>"moon"!==t.label))),a?(o++,h=0):(h++,h>=l&&(i.setMsg("click on the drawings to advance the story."),i.isActive=!0,h=0,l++))):(n=Cool.choice(s.actors.sprites),"moon"===n.label&&(o=0)),e.update(),n.setAction(),a=!1,n.dialog.state="ready"),"dialog"===c&&(t.isActive=!0,a=!0,n.moonNeedsToLeave&&n.leave())):"moon"===r&&"action"===c&&(t.isActive=!0)}}class Skelly extends Lobster{constructor(t){super(t),this.label="skelly"}chill(){this.animation.state=Cool.choice("idle_right","idle_left","talk_left","talk_right"),this.setActionCount(Cool.randomInt(30,240)),this.animation.loop=!1}start(){this.animation.state=Cool.choice("idle_right","idle_left","talk_left","talk_right")}setAction(){this.isActive=!0,this.emerge();let t=Cool.randomInt(1,6);for(let e=0;e<t;e++)this.addAction({target:this.isActionDone.bind(this),update:this.actionUpdate.bind(this),end:this.chill.bind(this)});this.addAction({target:this.isActionDone.bind(this),update:this.actionUpdate.bind(this),end:()=>{this.submerge(),this.speed=[0,0],this.setActionCount(120)}}),this.actionQueue.push({target:this.isActionDone.bind(this),update:this.actionUpdate.bind(this),end:()=>{this.callActionCallback(),this.position=[Cool.randomInt(128,GAME.halfWidth-128),Cool.randomInt(GAME.halfHeight+128,GAME.halfHeight+256)]}})}onDialogEnd(){let t=this.actionQueue.length;this.actionQueue=this.actionQueue.slice(t-2,t),this.start()}}function Story(t){let e,i={main:{}},s={},n=Object.keys(t.getGrammar()).filter((t=>t.length>1)),o=n.filter((t=>Cool.chance(.5)));this.getQuestion=function(){this.updateOverrides();let e=t.getText("Q",i.main);return this.addOverrides(e.tags,1,"main"),e.text},this.updateOverrides=function(t){for(const e in i)for(const s in i[e])Cool.chance(t||.5)||i[e][s].shift();Cool.chance(.5)&&o.shift(),Cool.chance(.5)&&o.push(Cool.choice(n.filter((t=>!o.includes(t)))))},this.addOverrides=function(t,e,s){i[s]||(i[s]={});for(let n=0;n<t.length-1;n++){if(!Cool.chance(e))continue;const{pos:a,word:h}=t[n];o.includes(a)&&(i[s][a]||(i[s][a]=[]),i[s][a].includes(h)||i[s][a].push(h))}},this.getResponse=function(n,o){let a={};o&&(a.C=[],s[o]||(s[o]=0),e||(e=t.getGrammar("C")),a.C.push(e[s[o]]),Cool.chance(.25)&&(s[o]+=1),s[o]=s[o]<e.length-1?s[o]+1:0);let h=t.getText("C",JSON.stringify({...i.main,...i[o],...a}));return this.addOverrides(h.tags,.1,"main"),o&&this.addOverrides(h.tags,.5,o),h.text}}"undefined"!=typeof module&&(module.exports=Story);class Wolf extends Dog{constructor(t){super(t),this.label="wolf",this.startPosition=[-this.width,GAME.height-this.height],this.startSpeed=[2,0]}firstTarget(){return this.position[0]>.25*GAME.width}endTarget(){return this.position[0]>GAME.width+this.width}checkSides(){this.speed[0]<0&&this.position[0]<this.halfWidth&&(this.speed[0]*=-1)}}function Fool(){const t=Cool.mobilecheck();t&&document.body.classList.add("mobile");const e=document.getElementById("lines"),i=e.parentElement;let s=getComputedStyle(i),n=i.clientWidth;n-=parseFloat(s.paddingLeft)+2*parseFloat(s.paddingRight);let o=n.clamp(768,1024),a=window.innerHeight-64,h=(Math.round(o/2),Math.round(a/2));t||(i.style.minHeight="1024px"),e.style.cursor="none";const l=new Game({dps:30,lineWidth:2,width:t?window.innerWidth:o,height:t?512:a,multiColor:!0,checkRetina:!0,suspend:!0,saveJsons:!0,scenes:["main"]});let r="./drawings/";"undefined"!=typeof fool_dir&&(r=fool_dir.foolURL+"/assets/holy_fool/drawings/");const c={fool:r+"fool.json",wolf:r+"wolf_3.json",moon:r+"moon_2.json",lobster:r+"lobster.json",skelly:r+"skelly_1.json",cursor:r+"cursor.json",letters:r+"letters.json",speech_left:r+"speech_left.json",speech_right:r+"speech_right.json",thought_left:r+"thought_left.json",thought_right:r+"thought_right.json"};let d,u,p,g,m,f,b,w,y,A,C={towers:3,waves:15,waves_2:14,landscapes:19,stuff:22};for(const t in C)for(let e=0;e<=C[t];e++)c[`${t}_${e}`]=r+`${t}/${t}-${e}.json`;l.loadAssets("sprites",c),document.addEventListener("keydown",(t=>{"s"===t.key&&A.newScene()})),l.start=function(){if(t){p=new Sprite(196,128,l.anims.sprites.moon),p.center=!0,p.animation.fps=1,p.animation.randomFrames=!0,p.animation.play(),l.scenes.main.addToDisplay(p);let t=new Text(32,256,"The Moon must be viewed on a desktop or laptop computer.",10,l.anims.sprites.letters);return l.scenes.main.addToDisplay(t),void(l.draw=function(){l.scenes.current.display()})}let e="./data/tsott-cfg.json",i="./data/tsott-cycle.json";"undefined"!=typeof fool_dir&&(e=fool_dir.foolURL+"/assets/holy_fool/data/tsott-cfg.json",i=fool_dir.foolURL+"/assets/holy_fool/data/tsott-cycle.json"),async function(){const t=await fetch(i).then((t=>t.json())),s=await fetch(e).then((t=>t.json()));let n=new CFGText;n.feed({...s,...t}),w=new Story(n),Object.assign(HolyFool.prototype,{onOver(){"ready"===this.dialog.state&&(f.animation.state="hover")},onOut(){f.animation.state="idle"},actionCallback:function(t,e){y.onActionEnd(t,e)},onClick:function(){y.moonIntroDone&&b.isActive&&(b.onDialogEnd=function(){b.isActive=!1,b.onDialogEnd=void 0}),"ready"===this.dialog.state&&f.isActive&&(this===p?(y.moonIntroDone||(y.moonIntroDone=!0,b.isActive=!1,p.dialog.state="finished",y.actors.add(p)),this.startDialog(w.getQuestion(),!0),A.newScene()):this.startDialog(w.getResponse("C",this.label),!0),f.isActive=!1)}}),b=new Text(32,32,"click on the moon to begin",16,GAME.anims.sprites.letters),b.endDelay=50,b.countForward=!0,b.countBackward=!0,l.scenes.main.addToDisplay(b),f=new Sprite(100,100,l.anims.sprites.cursor),f.center=!0,f.animation.play(),f.isActive=!1,f.animation.state="idle",l.scenes.add(f,["main"],"display"),A=new SceneryManager(C,f),A.setup(),y=new Sequencer(f,A,b),p=new Moon({x:o+128,y:256,animation:l.anims.sprites.moon,hasDialog:!0}),l.scenes.main.add(p),p.setDialogMessage(w.getQuestion()),p.setAction(!0),y.setCurrentActor(p),d=new Dog({x:o+l.anims.sprites.fool.width,y:a-l.anims.sprites.fool.height,animation:l.anims.sprites.fool,hasDialog:!0}),l.scenes.main.add(d),y.actors.add(d),u=new Wolf({x:-l.anims.sprites.wolf.width,y:a-l.anims.sprites.wolf.height,animation:l.anims.sprites.wolf,hasDialog:!0}),l.scenes.main.add(u),y.actors.add(u),g=new Lobster({x:o-128,y:h+128,animation:l.anims.sprites.lobster,hasDialog:!0}),l.scenes.main.add(g),y.actors.add(g),m=new Skelly({x:Cool.randomInt(128,o-128),y:Cool.randomInt(h+128,h+256),animation:l.anims.sprites.skelly,hasDialog:!0}),l.scenes.main.add(m),y.actors.add(m)}()},l.update=function(t){l.scenes.current.update()},l.draw=function(){l.scenes.current.display()},l.mouseMoved=function(t,e){l.scenes.current.mouseMoved(t,e),f&&(f.position=[t,e])},l.mouseDown=function(t,e){l.scenes.current.mouseDown(t,e),f.animation.state="click"},l.mouseUp=function(t,e){l.scenes.current.mouseUp(t,e),f.animation.state="idle"}}
//# sourceMappingURL=src_maps/fool.min.js.map
