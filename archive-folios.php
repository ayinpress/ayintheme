<?php/** * The template for displaying the Folio page * * @link https://developer.wordpress.org/themes/basics/template-hierarchy/#single-post * * @package Ayin * @since 1.0.0 */get_header();?>	<section id="primary" class="content-area">		<main id="main" class="site-main" role="main"><?php			// pull main info about this category			$category = get_category(get_query_var( 'cat' ));			$categoryId = $category->cat_ID;			$categoryDescription = category_description($categoryId);			if (!empty(get_field('category_date_field', 'category_' . $categoryId))) {				$folioDate = DateTime::createFromFormat('m/d/Y', get_field('category_date_field', 'category_' . $categoryId));			} else {				$folioDate = null;			}			if (!empty(get_field('folio_curators', 'category_' . $categoryId))) {				$folioCurators = get_field('folio_curators', 'category_' . $categoryId);			} else {				$folioCurators = null;			}			if (!empty(get_field('folio_description', 'category_' . $categoryId))) {				$folioDescription = get_field('folio_description', 'category_' . $categoryId);			} else {				$folioDescription = null;			}			// define these two variables here so we can access them in JavaScript at bottom of file			$defaultImagePath = '';			$defaultCaption = '';  ?>			<article id="post-<?php echo $categoryId; ?>">				<div class="entry-content">					<div class="folios-page-container alignwide">						<?php						$categoryParentTitle = single_term_title('', false);						if (!empty($categoryParentTitle)) {							echo ('<h1>' . $categoryParentTitle . '</h1>');						} 						// display full description at top of archive page, if filled in						if (!empty($categoryDescription)) {							echo($categoryDescription);						} ?>						<hr class="AyinDivider">						<div class="folios-grid">							<div class="folios-column"><?php					// display list of posts associated with this category					$firstCatId = 0;					$folioParentJS = '';					//echo '<ul class="FolioChildren">';					// add item to JS used below to map folio name to category Id					//$folioParentJS .= 'if (folioSlug == \'' . $category->slug . '\') catId = ' . $categoryId . ';' . "\r\n";					// get list of all posts within this category and set folio category settings					$folioName = $category->name;					$folioImagePath = '';					$sorted_posts = array();					$posts = get_posts( array(						'cat' => $categoryId,						'posts_per_page' => -1					));					if (sizeof($posts) > 0) {						foreach ($posts as $post) {							$sorted_posts[] = array(								'display_order' => get_field('folio_order', $post->ID),								'title' => $post->post_title,								'post' => $post,							);						}						// sort by display_order and then title						usort($sorted_posts, 'post_compare');						// set default Folio image path as the default image of the first post in category						foreach ($sorted_posts as $item) {							$useAsDefaultImage = get_field('folio_default_image', $item['post']->ID);							if ($folioImagePath == '' && $useAsDefaultImage && $useAsDefaultImage[0] == 'Yes') {								$folioImagePath = get_the_post_thumbnail_url($item['post']->ID, 'single-post-thumbnail');								$folioImageTitle = empty(get_post(get_post_thumbnail_id($item['post']->ID))->post_title) ? $folioName : get_post(get_post_thumbnail_id($item['post']->ID))->post_title;							}						}						if (empty($folioImagePath)) {							$folioImagePath = '/wp-content/uploads/2021/02/Ayin_Glyph_Black.png';							$folioImageTitle = $folioName;						}					}					//echo '	<li id="folioParent' . $categoryId . '" class="FolioParentTitle" data-thumbnail="' . esc_attr($folioImagePath) . '" data-title="' . esc_attr($folioImageTitle) . '">';					//echo '<div class="ArrowDown"><a href="javascript:toggle_folio(' . $categoryId . ', \'' . $category->slug . '\', false, false);">' . esc_html($folioName) . '</a>';										//echo('</div>');					echo '		<ul id="folioList' . $categoryId . '" class="FolioArticleTitles">';					//if ($folioCurators || $folioDescription) {						//echo('<div class="FolioCandD">');						//if ($folioCurators) echo('<div class="FolioCurators">' . esc_html($folioCurators) . '</div>');						//if ($folioDescription) echo('<div class="FolioDescription">' . esc_html($folioDescription) . '</div>');						//echo('</div>');					//}					$defaultImagePath = $folioImagePath;					$defaultCaption = $folioImageTitle;					$firstCatId = $categoryId;					foreach ($sorted_posts as $item) {						$folioTitle = get_the_title($item['post']->ID);						$folioPermalink = get_permalink($item['post']->ID);						$folioThumbnail = get_the_post_thumbnail_url($item['post']->ID, 'single-post-thumbnail');						$folioThumbnailTitle = empty(get_post(get_post_thumbnail_id($item['post']->ID))->post_title) ? $folioTitle : get_post(get_post_thumbnail_id($item['post']->ID))->post_title;						$journalAuthor = get_field('artist_name', $item['post']->ID);						$folioAuthor = get_field('folio_artist_name', $item['post']->ID);						$columnAuthor = get_field('column_author_name', $item['post']->ID);						$zineAuthor = get_field('zine_author_names', $item['post']->ID);						if (!empty ($journalAuthor)) {							$postAuthor = $journalAuthor;						} elseif (!empty ($folioAuthor)) {							$postAuthor = $folioAuthor;						} elseif (!empty ($columnAuthor)) {							$postAuthor = $columnAuthor;						} elseif (!empty ($zineAuthor)) {							$postAuthor = $zineAuthor;						} else {							$postAuthor = '';						}						echo('<li class="folio-article-preview" data-thumbnail="' . esc_attr($folioThumbnail) . '" data-title="' . esc_attr($folioThumbnailTitle) . '"><a href="' . $folioPermalink . '">' . $folioTitle . '&nbsp;&nbsp;&ndash;&nbsp;&nbsp;' . $postAuthor . '</a><img src="' . esc_attr($folioThumbnail) . '"></li>');					}					wp_reset_postdata();					echo '		</ul>';					//echo '	</li>';					//echo('</ul>');					echo(						'		</div>							<div class="folios-column folio-preview">								<img id="folio-work-preview"/>								<p id="folio-work-title"></p>							</div>						</div>					</div>'); ?>					<script>						let currentItem = <?php echo $firstCatId; ?>;						let freezeToggle = false;						function toggle_folio(flid, fs, scrollTo=false, updateHash=false) {							if (!freezeToggle) {								freezeToggle = true;								let parentLink = jQuery('#folioParent' + flid + ' > div > a');								let parentLinkDiv = jQuery('#folioParent' + flid + ' > div:first-child');								let list = jQuery('#folioList' + flid);								if (list.is(':visible')) {									parentLinkDiv.removeClass('ArrowDown');									parentLinkDiv.addClass('ArrowRight');									currentItem = 0;								} else {									if (currentItem > 0) {										let oldLink = jQuery('#folioParent' + currentItem + ' > div:first-child');										let oldList = jQuery('#folioList' + currentItem);										oldLink.removeClass('ArrowDown');										oldLink.addClass('ArrowRight');										oldList.slideToggle('slow');									}									parentLinkDiv.removeClass('ArrowRight');									parentLinkDiv.addClass('ArrowDown');									currentItem = flid;								}								if (scrollTo) {									list.slideToggle('slow', function() {										jQuery('html, body').animate({											scrollTop: jQuery('#folioParent' + flid).offset().top - jQuery('#masthead').outerHeight()										}, 1000);										freezeToggle = false;									});								} else {									list.slideToggle('slow', function() {										freezeToggle = false;									});								}								if (updateHash) window.location.hash = '#' + fs;							}						}						jQuery(function() {							let folioPreview = document.getElementById('folio-work-preview');							let folioPreviewTitle = document.getElementById('folio-work-title');							if (folioPreview && folioPreviewTitle) {<?php								if (!empty($defaultImagePath)) { ?>								folioPreview.src = '<?php echo esc_js($defaultImagePath); ?>';<?php								} else { ?>								folioPreview.src = '/wp-content/uploads/2021/02/Ayin_Glyph_Black.png';<?php								}								if (!empty($defaultCaption)) { ?>								folioPreviewTitle.innerHTML = '<?php echo esc_js($defaultCaption); ?>';<?php								} else { ?>								folioPreviewTitle.innerHTML = `Ayin | Folio`;<?php								} ?>								jQuery('li.folio-article-preview').each(function() {									let thumb = jQuery(this).data('thumbnail');									let title = jQuery(this).data('title');									jQuery(this).children('a').mouseover(function() {										folioPreview.src = thumb;										folioPreviewTitle.innerHTML = title;									});								});								jQuery('li.FolioParentTitle').each(function() {									let thumb = jQuery(this).data('thumbnail');									let title = jQuery(this).data('title');									jQuery(this).children('a').mouseover(function() {										folioPreview.src = thumb;										folioPreviewTitle.innerHTML = title;									});								});							}							// check if there is a hash associated with URL; is so, grab link, check if a category ID, and then open that category, and scroll down							if (window.location.hash) {								let hash = window.location.hash.toLowerCase();								if (hash.indexOf('#') === 0) {									let catId = 0;									let folioSlug = hash.substr(1);									<?php echo $folioParentJS; ?>									if (catId > 0) {										if (jQuery('#folioParent' + catId).length) {											if (catId !== <?php echo $firstCatId; ?>) {												toggle_folio(catId, folioSlug, true, false);											} else {												jQuery('html, body').animate({													scrollTop: jQuery('#folioParent' + catId).offset().top - jQuery('#masthead').outerHeight()												}, 1000);											}										}									}								}							}						});					</script>				</div>			</article><!-- #post-<?php the_ID(); ?> -->		</main><!-- #main -->	</section><!-- #primary --><?phpget_footer();// compare by datefunction date_compare($element1, $element2) {	$datetime1 = strtotime($element1['d']);	$datetime2 = strtotime($element2['d']);	return $datetime2 - $datetime1;}// compare by display order first; if those are equal, then display by title alphabeticallyfunction post_compare($element1, $element2) {	$displayOrder1 = $element1['display_order'];	$displayOrder2 = $element2['display_order'];	if (empty($displayOrder1)) {		$displayOrder1 = 100;	} else {		$displayOrder1 = intval($displayOrder1);	}	if (empty($displayOrder2)) {		$displayOrder2 = 100;	} else {		$displayOrder2 = intval($displayOrder2);	}	if ($displayOrder1 == $displayOrder2) {		return strcmp($element1['title'], $element2['title']);	} else {		return $displayOrder1 - $displayOrder2;	}}